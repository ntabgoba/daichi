)
comp_new <- select(compare_airt, air_t, air_cal)
ggplot(data = comp_new) +
geom_point(mapping = aes(x =! is.na(air_t), y =! is.na(air_cal)))
ggplot(data = comp_new) +
geom_point(mapping = aes(x = air_t, y =air_cal),na.rm = TRUE)
library(ggplot2)
library(nycflights13)
library(dplyr)
filter(flights, month == 11 | month == 12)
amb <- filter(flights, month == 11 | month == 12)
tail(amb)
amb <- filter(flights, month == 11 | month == 12)
tail(amb)
filter(flights, arr_delay <= 120, dep_delay <= 120)
jio <- arrange(flights, year, month, day)
jio
jio <- arrange(flights, year, desc(month), day)
jio
tail(jio)
View(jio)
y <- c(1, 2, 2, NA, 3, 4)
data_frame(
row_number(y),
min_rank(y),
dense_rank(y),
percent_rank(y),
cume_dist(y)
) %>% knitr::kable()
by_day <- group_by(flights, year, month, day)
View(by_day)
by_ds <- summarise(by_day, delay = mean(dep_delay, na.rm = TRUE))
View(by_ds)
by_dest <- group_by(flights, dest)
View(by_dest)
View(by_dest)
delay <- summarise(by_dest,
count = n(),
dist = mean(distance, na.rm = TRUE),
delay = mean(arr_delay, na.rm = TRUE))
View(delay)
flid <- flights[[dest]]
flid <- flights[flights$dest]
flid <- select(flights, dest)
dim(flid)
flid <- arrange(flights, dest)
dim(flid)
View(flid)
flid_d <- summarise(flid,
count = n(),
dist = mean(distance, na.rm = TRUE)
delay = mean(arr_delay, na.rm = TRUE)
)
flid_d <- summarise(flid,
count = n(),
dist = mean(distance, na.rm = TRUE),
delay = mean(arr_delay, na.rm = TRUE)
)
View(flid_d)
not_cancelled <- filter(flights, !is.na(dep_delay), !is.na(arr_delay))
View(not_cancelled)
not_cancelled <- select(flights, !is.na(dep_delay), !is.na(arr_delay))
not_cancelled <- arrnge(flights, !is.na(dep_delay), !is.na(arr_delay))
not_cancelled <- arrange(flights, !is.na(dep_delay), !is.na(arr_delay))
View(not_cancelled)
library(ggplot2)
library(nycflights13)
library(dplyr)
View(flights)
fli_15early <- select(flights, dep_delay == -15 | dep_delay == -15)
fli_15early <- filter(flights, dep_delay == -15 | dep_delay == -15)
dim(fli_15early)
View(fli_15early)
fli_15early <- filter(flights, dep_delay == -15 | arr_delay == -15)
dim(fli_15early)
View(fli_15early)
fli_15early <- filter(flights, dep_delay == -15 | arr_delay == 15)
dim(fli_15early)
View(fli_15early)
fli_15early <- filter(flights, dep_delay == -15 | dep_delay == 15)
dim(fli_15early)
View(fli_15early)
dep_delay15 <- filter(flights, dep_delay == -15 | dep_delay == 15)
dim(fli_15early)
View(fli_15early)
arr_delay15 <- filter(flights, arr_delay == -15 | arr_delay == 15)
dim(arr_delay15)
View(arr_delay15)
fiteen_laters <- mutate(flights,)
dep_arr15 <- filter(flights,
dep_delay15 <- filter(flights, dep_delay == -15 | dep_delay == 15),
arr_delay15 <- filter(flights, arr_delay == -15 | arr_delay == 15)
)
dep_arr15 <- filter(flights,
dep_delay15 = filter(flights, dep_delay == -15 | dep_delay == 15),
arr_delay15 = filter(flights, arr_delay == -15 | arr_delay == 15)
)
dep_arr15 <- transmute(flights, dep_delay15, arr_delay15)
dep_arr15 <- select(flights,carrier dep_delay, arr_delay)
dep_arr15 <- select(flights, carrier, dep_delay, arr_delay)
dim(dep_arr15)
View(dep_arr15)
arrange(dep_arr15, carrier)
by_dest <- group_by(flights, dep_delay, arr_delay)
by_delay <- group_by(flights, dep_delay, arr_delay)
View(by_delay)
arr_delay15 = (arr_delay == -15 | arr_delay == 15)
by_delay <- group_by(flights, dep_delay, arr_delay)
delay15 <- summarise(by_delay,
count = n(),
dep_delay15 = (dep_delay == -15 | dep_delay == 15),
arr_delay15 = (arr_delay == -15 | arr_delay == 15)
)
dep_delay15 <- filter(flights, dep_delay == -15 | dep_delay == 15)
arr_delay15 <- filter(flights, arr_delay == -15 | arr_delay == 15)
jio <- mutate(flights,dep_delay15, arr_delay15)
jio <- mutate(dep_delay15, arr_delay15)
jio <- mutate(dep_delay15, arr_delay15)
dim(dep_delay15)
dim(arr_delay15)
dep_arrde15 <- filter(flights, dep_delay == -15,dep_delay == 15, arr_delay == -15, arr_delay == 15)
View(dep_arrde15)
dep_arrde15 <- filter(flights, dep_delay == -15 | dep_delay == 15 | arr_delay == -15 | arr_delay == 15)
View(dep_arrde15)
by_co <- group_by(dep_arrde15, carrier)
count = n()
per_co <- summarise(by_co,
count = n()
)
View(per_co)
per_co <- summarise(by_co,
count = n(),
dep_mean = mean(dep_delay, na.rm = TRUE),
arr_mean = mean(dep_delay, na.rm = TRUE)
)
View(per_co)
sum(n_distinct(flights$carrier))
sum(count(flights$carrier))
sum(count(flights$carrier))
sum(n_distinct(flights$carrier))
fli_carrier <- group_by(flights, carrier)
fli_co <- summarise(fli_carrier,
count = n(),
dep_mean = mean(dep_delay, na.rm = TRUE),
arr_mean = mean(dep_delay, na.rm = TRUE)
)
View(fli_co)
ggplot(data = diamonds) +
geom_bar(mappping = aes(x = cut))
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mappping = aes(x = cut))
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut))
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, alpha = 0.5, fill = cut, size = 5, weight = 2))
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, alpha = 0.5, fill = cut, size = 2, weight = 2))
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, alpha = 0.5, fill = cut, size = 2))
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut, alpha = 1, fill = cut, size = 2))
library(ggplot2)
ggplot(data = diamonds) +
geom_bar(mapping = aes(x = cut,fill = cut))
ggplot(data = diamonds) +
geom_histogram(aes(x = carat))
ggplot(data = diamonds) +
geom_histogram(aes(x = carat), binwidth = 1)
ggplot(data = diamonds) +
geom_histogram(aes(x = carat), binwidth = 0.01)
ggplot(data = economics) +
geom_point(aes(x = date, y = unemploy))
ggplot(data = mpg) +
geom_point(mapping = aes(x = displ, y = hwy))
ggplot(data = diamonds) +
geom_point(mapping = aes(x = carat, y = price)) +
geom_smooth(mapping = aes(x = carat, y = price))
cor(diamonds$carat, diamonds$price)
library(tibble)
?tibble
as_data_frame(iris)
class(as.data.frame(tbl_df(iris)))
library(readr)
library(tidyr)
library(dplyr)
libary(DSR)
install.packages("DSR")
libary(DSR)
install.packages("DSR")
library(nycflights13)
library(dplyr)
library(stringr)
library(ggplot2)
library(lubridate)
install.packages("lubridate"")
install.packages("lubridate")
library(lubridate)
datetimes <- flights %>%
mutate(departure = make_datetime(year = year, month = month, day = day,
hour = hour, min = minute))
head(datetimes)
(datetimes <- flights %>%
mutate(departure = make_datetime(year = year, month = month, day = day,
hour = hour, min = minute)))
(datetimes <- datetimes %>%
mutate(arrival = make_datetime(year = year, month = month, day = day,
hour = str_sub(arr_time, end = -3),
min = str_sub(arr_time, start = -2))) %>%
filter(!is.na(departure), !is.na(arrival)) %>%
select(departure, arrival, dep_delay, arr_delay, carrier, tailnum,
flight, origin, dest, air_time, distance))
trial <- ymd("20170131")
unclass(trial)
class(trial)
library(ggplot2)
library(dplyr)
library(mgcv)
library(splines)
library(broom)
heights
head(heights)
?mgcv
?splines
?broom
library(ggplot2)
library(ggplot2)
getwd()
library(ggplot2)
knit_with_parameters('~/Desktop/manhatta/manhattanestates.Rmd')
library(knitr)
knit_with_parameters('~/Desktop/manhatta/manhattanestates.Rmd')
rm(list=ls())
ls()
R.version()
?version
R.Version()
library(h2o)
localH2O = h2o.init(nthreads=-1)
localH2O = h2o.init(nthreads=-1)
demo(h2o.kmeans)
demo(h2o.kmeans)
weight.i <- 0.01*matrix(rnorm(layer.size(i)*layer.size(i+1)),
nrow=layer.size(i),
ncol=layer.size(i+1))
input <- matrix(1:4, nrow=2, ncol=2)
weights <- matrix(1:6, nrow=2, ncol=3)
bias <- matrix(1:3, nrow=1, ncol=3)
input %*% weights + bias
s1 <- input %*% weights + matrix(rep(bias, each=2), ncol=3)
s2 <- sweep(input %*% weights ,2, bias, '+')
?sweep
?"%*%"
A <- array(1:24, dim = 4:2)
A
A
A
A <- array(1:5, dim = 4:2)
A
A <- array(1:5)
A
A <- array(1:5, dim = 2:2)
A
A <- array(1:5, dim = 3:2)
A
A <- array(1:5, dim = 3:1)
A
s2 <- sweep(input %*% weights ,2, bias, '+')
all.equal(s1, s2)
summary(iris)
summary(iris)
str(ir.model)
str(iris.model)
s1
max(0, s1)
pmax(0, s1)
pmax(s1, 0)
predict.dnn <- function(model, data = X.test) {
# new data, transfer to matrix
new.data <- data.matrix(data)
# Feed Forwad
hidden.layer <- sweep(new.data %*% model$W1 ,2, model$b1, '+')
# neurons : Rectified Linear
hidden.layer <- pmax(hidden.layer, 0)
score <- sweep(hidden.layer %*% model$W2, 2, model$b2, '+')
# Loss Function: softmax
score.exp <- exp(score)
probs <-sweep(score.exp, 1, rowSums(score.exp), '/')
# select max possiblity
labels.predicted <- max.col(probs)
return(labels.predicted)
}
train.dnn <- function(x, y, traindata=data, testdata=NULL,
model = NULL,
# set hidden layers and neurons
# currently, only support 1 hidden layer
hidden=c(6),
# max iteration steps
maxit=2000,
# delta loss
abstol=1e-2,
# learning rate
lr = 1e-2,
# regularization rate
reg = 1e-3,
# show results every 'display' step
display = 100,
random.seed = 1)
{
# to make the case reproducible.
set.seed(random.seed)
# total number of training set
N <- nrow(traindata)
# extract the data and label
# don't need atribute
X <- unname(data.matrix(traindata[,x]))
# correct categories represented by integer
Y <- traindata[,y]
if(is.factor(Y)) { Y <- as.integer(Y) }
# create index for both row and col
# create index for both row and col
Y.len   <- length(unique(Y))
Y.set   <- sort(unique(Y))
Y.index <- cbind(1:N, match(Y, Y.set))
# create model or get model from parameter
if(is.null(model)) {
# number of input features
D <- ncol(X)
# number of categories for classification
K <- length(unique(Y))
H <-  hidden
# create and init weights and bias
W1 <- 0.01*matrix(rnorm(D*H), nrow=D, ncol=H)
b1 <- matrix(0, nrow=1, ncol=H)
W2 <- 0.01*matrix(rnorm(H*K), nrow=H, ncol=K)
b2 <- matrix(0, nrow=1, ncol=K)
} else {
D  <- model$D
K  <- model$K
H  <- model$H
W1 <- model$W1
b1 <- model$b1
W2 <- model$W2
b2 <- model$b2
}
# use all train data to update weights since it's a small dataset
batchsize <- N
# init loss to a very big value
loss <- 100000
# Training the network
i <- 0
while(i < maxit && loss > abstol ) {
# iteration index
i <- i +1
# forward ....
# 1 indicate row, 2 indicate col
hidden.layer <- sweep(X %*% W1 ,2, b1, '+')
# neurons : ReLU
hidden.layer <- pmax(hidden.layer, 0)
score <- sweep(hidden.layer %*% W2, 2, b2, '+')
# softmax
score.exp <- exp(score)
# debug
probs <- score.exp/rowSums(score.exp)
# compute the loss
corect.logprobs <- -log(probs[Y.index])
data.loss  <- sum(corect.logprobs)/batchsize
reg.loss   <- 0.5*reg* (sum(W1*W1) + sum(W2*W2))
loss <- data.loss + reg.loss
# display results and update model
if( i %% display == 0) {
if(!is.null(testdata)) {
model <- list( D = D,
H = H,
K = K,
# weights and bias
W1 = W1,
b1 = b1,
W2 = W2,
b2 = b2)
labs <- predict.dnn(model, testdata[,-y])
accuracy <- mean(as.integer(testdata[,y]) == Y.set[labs])
cat(i, loss, accuracy, "\n")
} else {
cat(i, loss, "\n")
}
}
# backward ....
dscores <- probs
dscores[Y.index] <- dscores[Y.index] -1
dscores <- dscores / batchsize
dW2 <- t(hidden.layer) %*% dscores
db2 <- colSums(dscores)
dhidden <- dscores %*% t(W2)
dhidden[hidden.layer <= 0] <- 0
dW1 <- t(X) %*% dhidden
db1 <- colSums(dhidden)
# update ....
dW2 <- dW2 + reg*W2
dW1 <- dW1  + reg*W1
W1 <- W1 - lr * dW1
b1 <- b1 - lr * db1
W2 <- W2 - lr * dW2
b2 <- b2 - lr * db2
}
# final results
# creat list to store learned parameters
# you can add more parameters for debug and visualization
# such as residuals, fitted.values ...
model <- list( D = D,
H = H,
K = K,
# weights and bias
W1= W1,
b1= b1,
W2= W2,
b2= b2)
return(model)
}
set.seed(1)
summary(iris)
plot(iris)
samp <- c(sample(1:50,25), sample(51:100,25), sample(101:150,25))
ir.model <- train.dnn(x=1:4, y=5, traindata=iris[samp,], testdata=iris[-samp,], hidden=10, maxit=2000, display=50)
labels.dnn <- predict.dnn(ir.model, iris[-samp, -5])
table(iris[-samp,5], labels.dnn)
mean(as.integer(iris[-samp, 5]) == labels.dnn)
library(nnet)
ird <- data.frame(rbind(iris3[,,1], iris3[,,2], iris3[,,3]),
species = factor(c(rep("s",50), rep("c", 50), rep("v", 50))))
ir.nn2 <- nnet(species ~ ., data = ird, subset = samp, size = 6, rang = 0.1,
decay = 1e-2, maxit = 2000)
labels.nnet <- predict(ir.nn2, ird[-samp,], type="class")
table(ird$species[-samp], labels.nnet)
mean(ird$species[-samp] == labels.nnet)
data1 <- ("i loss accuracy
50 1.098421 0.3333333
100 1.098021 0.3333333
150 1.096843 0.3333333
200 1.093393 0.3333333
250 1.084069 0.3333333
300 1.063278 0.3333333
350 1.027273 0.3333333
400 0.9707605 0.64
450 0.8996356 0.6666667
500 0.8335469 0.6666667
550 0.7662386 0.6666667
600 0.6914156 0.6666667
650 0.6195753 0.68
700 0.5620381 0.68
750 0.5184008 0.7333333
800 0.4844815 0.84
850 0.4568258 0.8933333
900 0.4331083 0.92
950 0.4118948 0.9333333
1000 0.392368 0.96
1050 0.3740457 0.96
1100 0.3566594 0.96
1150 0.3400993 0.9866667
1200 0.3243276 0.9866667
1250 0.3093422 0.9866667
1300 0.2951787 0.9866667
1350 0.2818472 0.9866667
1400 0.2693641 0.9866667
1450 0.2577245 0.9866667
1500 0.2469068 0.9866667
1550 0.2368819 0.9866667
1600 0.2276124 0.9866667
1650 0.2190535 0.9866667
1700 0.2111565 0.9866667
1750 0.2038719 0.9866667
1800 0.1971507 0.9866667
1850 0.1909452 0.9866667
1900 0.1852105 0.9866667
1950 0.1799045 0.9866667
2000 0.1749881 0.9866667  ")
data.v <- read.table(text=data1, header=T)
par(mar=c(5.1, 4.1, 4.1, 4.1))
plot(x=data.v$i, y=data.v$loss, type="o", col="blue", pch=16,
main="IRIS loss and accuracy by 2-layers DNN",
ylim=c(0, 1.2),
xlab="",
ylab="",
axe =F)
box()
axis(1, at=seq(0,2000,by=200))
axis(4, at=seq(0,1.0,by=0.1))
axis(2, at=seq(0,1.2,by=0.1))
mtext("training step", 1, line=3)
mtext("loss of training set", 2, line=2.5)
mtext("accuracy of testing set", 4, line=2)
legend("bottomleft",
legend = c("loss", "accuracy"),
pch = c(16,1),
col = c("blue","red"),
lwd=c(1,1)
)
getwd()
shiny::runApp('jaea/shi')
runApp('jaea/shi')
getwd()
shiny::runApp('~/RProjects2016/jaea/shi')
library(plotly)
runApp('~/RProjects2016/jaea/shi')
shiny::runApp('~/RProjects2016/jaea/shi')
library(plotly)
runApp('~/RProjects2016/jaea/shi')
runApp('~/RProjects2016/jaea/shi')
runApp('~/RProjects2016/jaea/shi')
